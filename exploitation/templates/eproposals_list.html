{% extends 'container_fluid.html' %}
{% load bootstrap4 personal_tags paginator_tags dashboard_tags %}

{% block page_title %}{{ title }}{% endblock %}
{% block section_active %}
    {{ status|get_status_name }}
{% endblock %}

{% block filters_form %}
    {% bootstrap_form proposals_filter.form layout='horizontal' horizontal_label_class='col-md-4' horizontal_field_class='col-md-8' show_help=False  %}
{% endblock %}

{% block add_object_url %}{% url 'exploitation:addget_eproposals' %}{% endblock %}
{% block add_object_name %}заявку{% endblock %}

{% block title_print %}{{ title }} - {{ status|get_status_name }}{% endblock %}
{% block table_head %}
    <th style="width: 5%;">№</th>
    <th style="width: 5%;">Добавлено</th>
    <th style="width: 30%;">Объект</th>
    <th style="width: 15%;">Контрагент</th>
    <th style="width: 15%;">Описание</th>
    <th style="width: 8%;">{% if status.slug != 'complete' %}План{% else %}Исполнено{% endif %}</th>
    <th style="width: 10%;">Исполн.</th>
    <th style="width: 10%;">Автор</th>
    <th style="width: 2%;">Акт</th>
{% endblock %}

{% block table_body %}
    {% for item in proposals %}
        <tr class="table-{{ item.Status.tr_color }}" id="obj_{{ item.id }}" target="_blank" onclick="javascript:window.open('{% url 'exploitation:addget_eproposals' item.id %}')">
            <td class="text-center">
                <abbr title="{{ item.TypeDocument.Name }}">Э{{ item.TypeDocument.short_name }}</abbr>
                {% if item.Status.slug == 'complete' %}
                    <i class="fa fa-mobile fa-lg" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Заявка закрыта с мобильного устройства"></i>
                {% endif %}
                {{ item.id }}
            </td>
            <td class="text-center">{{ item.DateTime_add|date:"d.m.Y H:i" }}</td>
            <td>{{ item.NumObject }} - {{ item.AddressObject }}</td>
            <td>
                {% if Client_choices %}
                    {{ item.Client_choices.Name }}
                {% else %}
                    {{ item.Client_words }}
                {% endif %}
            </td>
            <td>{{ item.FaultAppearance|truncatechars:50 }}</td>
            <td class="text-center">
                {% if status.slug != 'complete' %}
                    {{ item.DateTime_schedule|date:"d.m" }}<br/>{{ item.DateTime_schedule|date:"Y" }}
                {% else %}
                    {{ item.DateTime_work|date:"d.m" }}<br/>{{ item.DateTime_work|date:"Y" }}
                {% endif %}
            </td>
            <td class="text-center">
                <small>
                    {% for cowork in item.CoWorkers.all %}
                        {% if forloop.counter > 1 %},{% endif %} {{ cowork.id|view_shortfio_coworker }}<br/>
                    {% endfor %}
                </small>
            </td>
            <td class="text-center">
                <i class="fa fa-plus" aria-hidden="true"></i>
                <small> {{ item.Create_user|view_shortfio_user }}</small>
                {% if item.Update_user %}
                    <br/>
                    <i class="fa fa-pencil" aria-hidden="true"></i>
                    <small> {{ item.Update_user|view_shortfio_user }}</small>
                {% endif %}
            </td>
            <td>
                {% if item.Required_act and item.Date_act %}
                    <h2><span class="glyphicon glyphicon-file"></span></h2>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
{% endblock %}

{% block pagination %}
    {% include 'templatetags/pagination.html' with page_obj=proposals %}
{% endblock %}
